{"name": "API Test: Create VM", "status": "failed", "statusDetails": {"message": "AssertionError: Expected 201, got 422. Response: [{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateNewDiskItem.availability_zone_id\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.name\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.size\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.disk_type_id\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.availability_zone_id\"}]\nassert 422 == 201\n +  where 422 = <Response [422]>.status_code", "trace": "self = <test_vm_3_post_api.TestVMCreationAPI object at 0x7f329fa51bd0>\n\n        @allure.title(\"API Test: Create VM\")\n        @allure.link(\"https://jira.cloud.ru/browse/TASK-PENDING\", name=\"Related Task\")\n        @allure.tag(\"NORMAL\")\n        @allure.label(\"priority\", \"normal\")\n        def test_scenario(self):\n            # Arrange\n            base_url = \"https://compute.api.cloud.ru\"\n            endpoint = \"/api/v1/vms\"\n            token = os.getenv(\"CLOUD_API_TOKEN\")\n    \n            headers = {\n                \"Authorization\": f\"Bearer {token}\",\n                \"Content-Type\": \"application/json\"\n            }\n    \n            # --- ИСПРАВЛЕНИЯ: Подготовка данных с правильными отступами ---\n    \n            # 1. Уникальные имена (для избежания 409 Conflict)\n            unique_suffix = int(time.time())\n            VM_NAME = f\"test-vm-{unique_suffix}\"\n            DISK_NAME = f\"root-disk-{unique_suffix}\"\n    \n            # 2. Подготовка Cloud-init (Исправление IndentationError)\n            ssh_key = \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIBJ6i+hm43CEcEIuw0onvehbYW0rbcIHJnRGpVQqS1NX muhammad@222\"\n            cloud_init_script = f\"\"\"\n    #cloud-config\n    users:\n      - name: ubuntu\n        ssh-authorized-keys:\n          - {ssh_key}\n        sudo: ALL\n    \"\"\"\n            # -------------------------------------------------------------------\n    \n            # Payload: Array of objects (as per docs)\n            payload = [\n              {\n                \"project_id\": \"4582273a-e0e7-4fb4-b284-8a91cb03d106\",\n                \"name\": VM_NAME, # <<< ИСПРАВЛЕНО: Уникальное имя\n                \"availability_zone_id\": \"7c99a597-8516-494f-a2c7-d7377048681e\", # <<< ДОБАВЛЕНО: AZ на корневом уровне\n                \"flavor_id\": \"139ddd16-2482-4694-991d-9b1834266e03\",\n                \"image_id\": \"474c9e98-760f-4e54-aaa9-70024814f2b0\",\n    \n                \"subnets\": [\n                    {\n                    \"subnet_id\": \"abb61c39-8a65-4735-8d65-55174b795163\"\n                    }\n                ],\n                \"disks\": [\n                    {\n                    \"name\": DISK_NAME, # <<< ИСПРАВЛЕНО: Уникальное имя диска\n                    \"size\": 10,\n                    \"disk_type_id\": \"a859e3dc-6b14-42a8-9bcc-890fde0ba6d0\",\n                    \"availability_zone_id\": \"7c99a597-8516-494f-a2c7-d7377048681e\"\n                    }\n                ],\n    \n                \"description\": \"Auto-generated test VM\",\n                \"cloud_init\": cloud_init_script\n              }\n            ]\n    \n            # Act\n            with allure.step(f\"POST {endpoint}\"):\n                response = requests.post(base_url + endpoint, headers=headers, json=payload)\n    \n            # Assert\n            with allure.step(\"Check Status Code 201 (Created)\"):\n>               assert response.status_code == 201, f\"Expected 201, got {response.status_code}. Response: {response.text}\"\nE               AssertionError: Expected 201, got 422. Response: [{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateNewDiskItem.availability_zone_id\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.name\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.size\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.disk_type_id\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.availability_zone_id\"}]\nE               assert 422 == 201\nE                +  where 422 = <Response [422]>.status_code\n\ntest_vm_3_post_api.py:80: AssertionError"}, "steps": [{"name": "POST /api/v1/vms", "status": "passed", "start": 1765702824025, "stop": 1765702824421}, {"name": "Check Status Code 201 (Created)", "status": "failed", "statusDetails": {"message": "AssertionError: Expected 201, got 422. Response: [{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateNewDiskItem.availability_zone_id\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.name\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.size\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.disk_type_id\"},{\"message\":\"Extra inputs are not permitted\",\"code\":\"extra_forbidden\",\"field\":\"body.0.disks.0.VmCreateExistingDiskItem.availability_zone_id\"}]\nassert 422 == 201\n +  where 422 = <Response [422]>.status_code\n", "trace": "  File \"/home/muhammad/Dev/HACKATHON/Moscow/cloud.ru/Github/TestOps_Copilot/backend/tests/test_vm_3_post_api.py\", line 80, in test_scenario\n    assert response.status_code == 201, f\"Expected 201, got {response.status_code}. Response: {response.text}\"\n"}, "start": 1765702824421, "stop": 1765702824421}], "start": 1765702824025, "stop": 1765702824422, "uuid": "e6038461-0fd3-456d-886e-22e4c0950112", "historyId": "01a5fb23c88c918433b0bcbe58d59035", "testCaseId": "01a5fb23c88c918433b0bcbe58d59035", "fullName": "test_vm_3_post_api.TestVMCreationAPI#test_scenario", "labels": [{"name": "priority", "value": "normal"}, {"name": "story", "value": "Story: VMCreationAPI"}, {"name": "tag", "value": "NORMAL"}, {"name": "suite", "value": "API"}, {"name": "feature", "value": "VMCreationAPI"}, {"name": "subSuite", "value": "TestVMCreationAPI"}, {"name": "host", "value": "222"}, {"name": "thread", "value": "303715-MainThread"}, {"name": "framework", "value": "pytest"}, {"name": "language", "value": "cpython3"}, {"name": "package", "value": "test_vm_3_post_api"}], "links": [{"type": "link", "url": "https://jira.cloud.ru/browse/TASK-PENDING", "name": "Related Task"}, {"type": "link", "url": "https://jira.cloud.ru/browse/TASK-API-VM-CREATE", "name": "API Docs"}], "titlePath": ["test_vm_3_post_api.py", "TestVMCreationAPI"]}